{% extends 'base/base.html' %}

{% block title %}Inscription - Famille KANYAMUKENGE{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-brand-bg to-stone-100 py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-2xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-8">
            <div class="mx-auto w-20 h-20 bg-gradient-to-br from-brand-primary to-green-700 rounded-full flex items-center justify-center mb-4">
                <i data-feather="user-plus" class="w-10 h-10 text-white"></i>
            </div>
            <h1 class="font-serif text-3xl font-bold text-brand-primary mb-2">
                Bienvenue dans la famille !
            </h1>
            <p class="text-gray-600">
                Vous avez été invité(e) à rejoindre l'arbre généalogique de la famille KANYAMUKENGE
            </p>
        </div>

        <!-- Invitation Info -->
        <div class="bg-green-50 border border-green-200 rounded-xl p-4 mb-8">
            <div class="flex items-center gap-3">
                <i data-feather="mail" class="w-5 h-5 text-green-600"></i>
                <div>
                    <p class="text-sm font-medium text-green-800">
                        Invitation de {{ invitation.invited_by.get_full_name }}
                    </p>
                    <p class="text-xs text-green-700">
                        Envoyée le {{ invitation.created_at|date:"d F Y à H:i" }}
                    </p>
                </div>
            </div>
        </div>

        <!-- Registration Form -->
        <div class="bg-white rounded-2xl shadow-xl p-8 border border-brand-border">
            <h2 class="font-serif text-2xl font-bold text-gray-900 mb-6">
                Créer votre compte
            </h2>

            <form method="post" class="space-y-6" id="registerForm">
                {% csrf_token %}
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- First Name -->
                    <div>
                        <label for="{{ form.first_name.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                            <i data-feather="user" class="w-4 h-4 inline mr-1"></i>
                            Prénom *
                        </label>
                        {{ form.first_name }}
                        {% if form.first_name.errors %}
                            <div class="mt-1 text-sm text-red-600">
                                {{ form.first_name.errors.0 }}
                            </div>
                        {% endif %}
                    </div>

                    <!-- Last Name -->
                    <div>
                        <label for="{{ form.last_name.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                            <i data-feather="users" class="w-4 h-4 inline mr-1"></i>
                            Nom de famille *
                        </label>
                        {{ form.last_name }}
                        {% if form.last_name.errors %}
                            <div class="mt-1 text-sm text-red-600">
                                {{ form.last_name.errors.0 }}
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Email (read-only) -->
                <div>
                    <label for="{{ form.email.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                        <i data-feather="mail" class="w-4 h-4 inline mr-1"></i>
                        Adresse email
                    </label>
                    {{ form.email }}
                    <p class="mt-1 text-xs text-gray-500">
                        Cette adresse email est celle de votre invitation et ne peut pas être modifiée.
                    </p>
                </div>

                <!-- Username -->
                <div>
                    <label for="{{ form.username.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                        <i data-feather="at-sign" class="w-4 h-4 inline mr-1"></i>
                        Nom d'utilisateur *
                    </label>
                    {{ form.username }}
                    {% if form.username.errors %}
                        <div class="mt-1 text-sm text-red-600">
                            {{ form.username.errors.0 }}
                        </div>
                    {% endif %}
                    <p class="mt-1 text-xs text-gray-500">
                        Choisissez un nom d'utilisateur unique pour vous connecter.
                    </p>
                </div>

                <!-- Phone Number -->
                <div>
                    <label for="{{ form.phone_number.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                        <i data-feather="phone" class="w-4 h-4 inline mr-1"></i>
                        Numéro de téléphone (optionnel)
                    </label>
                    {{ form.phone_number }}
                    {% if form.phone_number.errors %}
                        <div class="mt-1 text-sm text-red-600">
                            {{ form.phone_number.errors.0 }}
                        </div>
                    {% endif %}
                </div>

                <!-- Password -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="{{ form.password1.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                            <i data-feather="lock" class="w-4 h-4 inline mr-1"></i>
                            Mot de passe *
                        </label>
                        <div class="relative">
                            {{ form.password1 }}
                            <button type="button" class="absolute inset-y-0 right-0 pr-3 flex items-center" onclick="togglePassword('{{ form.password1.id_for_label }}', 'eye1')">
                                <i data-feather="eye" class="w-5 h-5 text-gray-400" id="eye1"></i>
                            </button>
                        </div>
                        {% if form.password1.errors %}
                            <div class="mt-1 text-sm text-red-600">
                                {{ form.password1.errors.0 }}
                            </div>
                        {% endif %}
                    </div>

                    <div>
                        <label for="{{ form.password2.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                            <i data-feather="shield" class="w-4 h-4 inline mr-1"></i>
                            Confirmer le mot de passe *
                        </label>
                        <div class="relative">
                            {{ form.password2 }}
                            <button type="button" class="absolute inset-y-0 right-0 pr-3 flex items-center" onclick="togglePassword('{{ form.password2.id_for_label }}', 'eye2')">
                                <i data-feather="eye" class="w-5 h-5 text-gray-400" id="eye2"></i>
                            </button>
                        </div>
                        {% if form.password2.errors %}
                            <div class="mt-1 text-sm text-red-600">
                                {{ form.password2.errors.0 }}
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Password Requirements -->
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-3">
                    <h4 class="text-sm font-medium text-gray-700 mb-2">Exigences du mot de passe :</h4>
                    <ul class="text-xs text-gray-600 space-y-1">
                        <li class="flex items-center gap-1">
                            <i data-feather="check" class="w-3 h-3 text-green-500"></i>
                            Au moins 8 caractères
                        </li>
                        <li class="flex items-center gap-1">
                            <i data-feather="check" class="w-3 h-3 text-green-500"></i>
                            Ne doit pas être trop similaire à vos informations personnelles
                        </li>
                        <li class="flex items-center gap-1">
                            <i data-feather="check" class="w-3 h-3 text-green-500"></i>
                            Ne doit pas être un mot de passe couramment utilisé
                        </li>
                    </ul>
                </div>

                <!-- Terms Agreement -->
                <div class="flex items-start gap-3">
                    <input type="checkbox" id="terms" required class="mt-1 h-4 w-4 text-brand-primary focus:ring-brand-primary border-gray-300 rounded">
                    <label for="terms" class="text-sm text-gray-700">
                        J'accepte que mes informations soient conservées dans cette plateforme familiale privée.
                        Je comprends que ces données sont utilisées uniquement dans le cadre de l'arbre généalogique
                        de la famille KANYAMUKENGE et ne seront jamais partagées à des fins commerciales.
                    </label>
                </div>

                <!-- Submit Button -->
                <div>
                    <button type="submit" class="w-full bg-brand-primary text-white py-3 px-4 rounded-lg font-medium hover:bg-green-800 focus:ring-2 focus:ring-brand-primary focus:ring-offset-2 transition duration-200 flex items-center justify-center gap-2" id="registerButton">
                        <span id="registerText">Créer mon compte</span>
                        <i data-feather="arrow-right" class="w-4 h-4" id="registerIcon"></i>
                        <div class="hidden animate-spin rounded-full h-4 w-4 border-b-2 border-white" id="registerSpinner"></div>
                    </button>
                </div>
            </form>
        </div>

        <!-- Footer Info -->
        <div class="mt-8 text-center">
            <p class="text-xs text-gray-500">
                Une fois votre compte créé, vous pourrez contribuer à l'enrichissement 
                de l'arbre généalogique familial.
            </p>
        </div>
    </div>
</div>

<script>
    // Toggle password visibility
    function togglePassword(fieldId, eyeId) {
        const field = document.getElementById(fieldId);
        const eye = document.getElementById(eyeId);
        
        if (field.type === 'password') {
            field.type = 'text';
            eye.setAttribute('data-feather', 'eye-off');
        } else {
            field.type = 'password';
            eye.setAttribute('data-feather', 'eye');
        }
        feather.replace();
    }
    
    // Form submission loading state
    document.getElementById('registerForm').addEventListener('submit', function(e) {
        const terms = document.getElementById('terms');
        if (!terms.checked) {
            e.preventDefault();
            alert('Veuillez accepter les conditions d\'utilisation.');
            return;
        }
        
        const button = document.getElementById('registerButton');
        const text = document.getElementById('registerText');
        const icon = document.getElementById('registerIcon');
        const spinner = document.getElementById('registerSpinner');
        
        button.disabled = true;
        text.textContent = 'Création du compte...';
        icon.classList.add('hidden');
        spinner.classList.remove('hidden');
    });
    
    // Real-time password confirmation validation
    const password1 = document.getElementById('{{ form.password1.id_for_label }}');
    const password2 = document.getElementById('{{ form.password2.id_for_label }}');
    
    function validatePasswordMatch() {
        if (password2.value && password1.value !== password2.value) {
            password2.style.borderColor = '#ef4444';
        } else {
            password2.style.borderColor = '#d1d5db';
        }
    }
    
    if (password1 && password2) {
        password2.addEventListener('input', validatePasswordMatch);
        password1.addEventListener('input', validatePasswordMatch);
    }
</script>
{% endblock %}